CHANGE LOG FOR UNIFIED 3DVAR CODE
---------------------------------
Author(s)   :  Lidia Cucurull, John Derber, Jing Guo, Masahiro Kazumori, 
               Daryl Kleist, Shun Liu, Quanhua Liu, Dave Parrish, 
               Ricardo Todling, Russ Treadon, Wan-Shu Wu
Reviewer(s) :  Ricardo Todling, Russ Treadon
Date        :  3 March 2006
GMAO CVS tag:  starting tag:  gmao-gsi-2005_12
NCEP CVS tag:  this release:  ncep-gsi-2006_03



REASON FOR CHANGES
------------------
Changes are made to the gsi code for the following reasons:
(listing  below not given in any particular order)

 a) Bug fixes in
     1) convective precipitation forward model
     2) observation error adjustment for conventional profile data
     3) AQUA EOS AMSUA emissivity calculation
     4) argument error for ges_tv interpolation in setupspd, setupuv
     5) add indices to sum* variables being initialize in calctends_ad.f90
     6) add summation of vorticity at poles (variables not set before).  
        Since poles are not used in analysis, this change has no impact.
     7) correct tropopause pressure units for qoption=2
     8) block off tropopause calculations and bias correction updates when
        running code in regional 2DVAR mode
     9) correct upper bound on adjoint of smoothing interpolation loop 
        in routine get_ops3 (file fgrid2agrid_mod.f90)

 b) Use 3d guess pressure interpolated to observation location in error 
    adjustment routine used for conventional profile data 
    (read_prepbufr --> errormod)

 c) Improve mpi reproducibility when using mpi_allreduce.

 d) Replace pCRTM with CRTM (brightness temperature forward and jacobian 
    model).  With removal of pCRTM, no longer need emissivity routines
    used in previous GSI releases.  IRSSE and other emissivity models 
    (called from emiss.f90) have been absorbed into the CRTM.  This
    change assumes users have already installed CRTM on their platform.
    Configuration makefiles (Makefile.conf.*) have been modified to
    point to local builds of CRTM.   Related to this change, new binary fix
    files are required to run the the CRTM (see FIX FILE CHANGES below).

 e) Replace numeric NCEP satellite/instrument identifiers with explicit 
    strings.  This change not only affects entries in GSI namelist OBS_INPUT,
    but also the global and regional satinfo files, angle dependent bias
    correction file, and air mass bias correction file.  See FIX FILE CHANGES
    section for further information.

 f) Increase control over satellite radiance calculations/prepare for different
    sensors on same instrument

 g) Improve counting of read/keep/used obs for all types

 h) Add ability to read goes 1x1 data

 i) Clean up runtime output

 j) Clean up outer loop.  Move calls required prior/post setuprhsall into
    setuprhsall

 k) Add conventional data subtype (for future use) and clean up reading 
    of convinfo

 l) Simplify creation of surface fields for use in thinning satellite
    data.  Also added u10, v10 to surface fields in preparation for 
    future more sophisticated thinning.

 m) Correct error in gridmod related to use of filled_grid option in 
    regional WRF NMM mode.

 n) For AMSRE data, the thresholds for surface type determination are 
    modified for strict data usage and the origin of satellite azimuth 
    angle of AMSR-E for diag file are changed.  The original satellite 
    azimuth angle in AMSR-E bufrfile are stored in AMSR-E diag file.

 o) Consolidate routines which handle NCEP GFS i/o to single module.  
    Consolidate initial query of model guess file to single routine.
    Both changes are part of effort to confine analysis <--> model 
    interface to a few modules.  New NCEP GFS i/o module utilizes 
    NCEP sigio library and modules to handle i/o.  Users will need to
    install NCEP sigio on their platform in order to compile GSI.  The
    configuration Makefiles (Makefile.conf.*) have been modified to 
    include references to sigio.

 p) Add prefix "ges_" to guess pressure arrays "prsi", "prsl", "prslk", and
    "lnprsl" so as to make the name of all model guess variables consistent

 q) Modify background error to include projection for surface pressure 
    to all model levels.  This change is only in the global GSI.   This
    change also requires a change in the global background error.  See
    FIX FILE CHANGES section for more information.

 r) Use reported height for VAD, profiler, and PIBAL wind observations
    when vertically mapping guess to observation location.
 
 s) Changes to quality control for GPS local refractivity and bending
    angle observations.

 t) Change format of angle dependent and air mass bias correction files.
    The key change is removal of numeric NCEP satellite/sensor identifier
    in favor or an explicit character string.

 u) Provide new set of regional NMM background error statistics.  These
    statistics are based on forecast pairs taken from the full North
    America domain of the NMM.

 v) Change meaning of GSI namelist BKGERR variable hzscl to represent a
    scaling parameter for the horizontal length scales.  In previous GSI
    releases hzscl represented the inverse of the scaling parameter.  With
    this release hzscl represents the scaling factor:  <1.0 means shorten
    the length scale, >1.0 means increase the length scale.



SPECIAL NOTES
-------------
The following points should be noted with regards to the above
code changes.  The lettering below corresponds to the
"REASON FOR CHANGES" for lettering above:

 d,o) Changes to makefile configuration files for non-AIX platforms have
    NOT been tested.  Two changes are made:  1) remove reference to
    IRSSE (no longer needed), and 2) add reference to sigio.  Most makefile
    configuration files (Makefile.conf.*) already contained references to
    the CRTM (actually pCRTM).  Users must update their current copy of
    the pCRTM to the CRTM.  The GSI code can not be compiled without the
    CRTM library and modules.

 c,d) Related to changes in the satellite/sensor identifiers, the GSI namelist
    has changed accordingly.  Changes have been made GMAO's "analyzer" and 
    "gsi.rc.sample" to make these files consistent with new CRTM fixed files 
    and changes in GSI namelist parameters.  These changes have NOT been 
    tested.  

 e) Brightness temperature angle dependent and air mass bias correction files 
    ("satbias_angle" and "satbias_in", respectively, in radinfo.f90)
    from previous gsi releases are NOT compatible with the release.
    Users must reformat existing Tb angle dependent and air mass bias
    correction files to be consistent with the new format (see radinfo.f90)

 v) The meaning of the horizontal length scales, parameter hzscl, in 
    namelist BKGERR is changed.  In previous GSI releases hzscl represented
    the inverse of a factor used to increase/decrease the horizontal scales.
    This definition was not intutitive, nor was it consistent with the 
    defintion of the vertical scale parameter, vs.  With this GSI release
    namelist variable hzscl represents a scaling factor for the horizontal
    length scale (NOT the inverse of the scaling factor).  Thus, numbers
    less than 1.0 decrease the horizontal scale scale.  Number greater than
    1.0 increase the horizontal length scale.  The values of hzscl found in
    script files rungsi*sh and resource file gsi.rc.sample in this release
    have been inverted to be consistent with the new definition of hzscl.

 e) GSI Namelist OBS_INPUT is significantly altered with this update.  The
    changes are described more completely under the SCRIPT CHANGES section.
    One item to note here is that the character string used in array dsis
    is used by the CRTM to select the coefficients needed to run the CRTM
    for the given satellite/sensor.  The same dsis strings are found in 
    the satinfo and satang files.  Changing dsis to a string which the 
    CRTM does not recognize will cause the code to fail

 r) ***WARNING***  
    For reasons that have not been fully explored, the MASS core binary
    and netcdf test cases show a larger initial penalty for winds due
    to the change in the VAD and profiler forward model.  GSI Users /
    developers who run the GSI in MASS core mode should be aware of this.
    It's not clear at this time if the apparent problem with height 
    interpolation for the MASS core is a due to problems with the test
    case prepbufr file, the MASS core guess file, or if the problem 
    stems from internal GSI computations.  Thus, MASS core users are 
    advised to test pressure -vs- height interpolation (see setupw.f90) 
    for their specific cases.   



EXPECTED DIFFERENCES
--------------------
The following differences are expected when comparing GSI output from
this release from that from previous releases.  The lettering below
corresponds to the "REASON FOR CHANGES" for lettering above:

 a) Bug fixes have the following impacts
    1) Correction of bug in nlmsas_ad can significantly alter pcp
       penalty.  Previous version of nlmsas_ad omitted (i) index
       on logical variable which controls branching of convective
       precipitation algorithm.  This release correctly indexes 
       this array.

    2) Changes to upper limits upprof and dwprof do while loop tests
       in routine errormod (file qcmod.f90) lead to slightly different 
       adjustments in the observation error for profile type conventional
       data.  This change affect wind, temperature, and moisture penalties.

    3) Previous emiss.f90 routine computed incorrect emissivities for
       eos_amsua data.  This introduced a large bias (order 3K) in 
       channels 1 and 2 and a smaller bias (order 0.5K) in channels 3 
       and 15.  With current GSI release emissivity calculations are 
       now internal to CRTM.  EOS amsua emissivites computed correctly
       within CRTM.

    4) The tintrp2a call for tges in setupuv and setupspd incorrectly
       passed a vertical dimension of 1 (should be nsig).  This resulted
       in the wrong temperature values being used in the space/time 
       interpolation.  Correction of the error (use nsig as the vertical
       dimension) results in a slight difference in the initial wind 
       penalties

    5,6) No impact.

    7) When running with qoption=2, the code decouples the relationship 
       between moisture and temperature above the tropopause.  The guess
       pressure is in units of centibars which the tropopause pressure
       was in hPa.  Thus, q and T were decoupled throughout most of the
       depth of the atmosphere.  When units for the guess pressure and 
       tropopause are made consistent, tropospheric coupling of temperature
       and moisture is more evident in the analysis increments. 

    8,9) Allow GSI code to run in 2DVAR mode with debug options on without
         producing a seg fault.  These bugs apparently had no effect when
         running the GSI code when compiled in non-debug (optimized) mode.

 b) Changes noted in penalty for conventional profile data (winds,
    temperature, and moisture).  Initial penalties slightly increase
    due to less down-weighting (error inflation) of the observations.

 c) Changes made to calculation for ozmz (read_guess.f90) and bias 
    correction portion of fhat array (intall.f90).  Changes slightly
    after results of minimization (difference in eigth decimal place).

 d) Change from pCRTM to CRTM obviously changes simulated Tb.  This
    in turn affect the number of observations assimilated.  This 
    initial difference leads to a small differences in analysis
    results.  Extensive pCRTM -vs- CRTM comparisions show that for
    most sensors and channels the impact of switching from the pCRTM
    to CRTM is minimal.  However, for certain sensors/channels the
    CRTM is a noticeable improvement over the pCRTM.  This initial
    implementation of the CRTM within the GSI does NOT take advantage
    of many capabilities available in the CRTM.  Such developments
    will be included in future GSI update.
 
 s) Using the reported height when vertically interpolating the model
    winds to the observation location (done only for VAD, profile, and
    PIBAL winds) leads to small but consistent reductions in the initial
    (ie, guess) fit to the observations.  



FILES REMOVED
-------------
 ajmpcp.f90         - functionality replace by pcp_k.f90
 calctends_adj.f90  - functionality replaced by calctends_ad.f90
 calctends_tlm.f90  - functionality replaced by calctends_tl.f90
 emiss.f90          - functionality absorbed into CRTM
 emiss_ssmi.f90     - functionality absorbed into CRTM
 iceem_amsu.f90     - functionality absorbed into CRTM
 landem.f90         - functionality absorbed into CRTM
 pcpinfo.F90        - renamed pcpinfo.f90
 rdgesfc.f90        - functionality moved into ncepgfs_io.f90
 rdgesig.f90        - functionality moved into ncepgfs_io.f90
 rdsfull.f90        - functionality moved into ncepgfs_io.f90
 read_ieeetovs.f90  - remove obsolete capability (no longer process IEEE TOVS)
 snwem_amsu.f90     - functionality absorbed into CRTM
 wrsfca.f90         - functionality moved into ncepgfs_io.f90
 wrsiga.f90         - functionality moved into ncepgfs_io.f90



FILES ADDED
-----------
 convinfo.f90   - module containing routines which handle information 
                  in convinfo.txt 
 gesinfo.f90    - query model guess files for time, coordinate, and
                  other model guess related information
 ncepgfs_io.f90 - module containing routines which handle i/o for 
                  NCEP GFS atmospheric and surface files



FILES MODIFIED
-------------- 
 anprewgt_reg.f90        - rename "prsl" as "ges_prsl"; clean up formatting
                           of routine; replace local constants with those 
                           defined in constants module; remove references
                           to mpi_real8, mpi_real4,mpi_max,mpi_min,mpi_sum
                           since not used anywhere
 balmod.f90              - add full nsig projection for surface pressure
 berror.f90              - remove set_nrh_var and move capability to 
                           compute_derived
 calctends_ad.f90        - add indices to sum* variables being initialized 
 compact_diffs.f90       - fix pole calculations (no impact)
 compute_derived.f90     - clean up print out; include calculation of sigsum;
                           add capability of set_nrh_var; correct error in
                           tropopause pressure units when using qoption=2;
                           consolidate and unify use of guess pressure arrays
 dtast.f90               - modify to take advantage of convinfo module
 dvast.f90               - modify to take advantage of convinfo module; add
                           bias to statistics computed/written
 fgrid2agrid_mod.f90     - correct upper limit for loop related to adjoint 
                           of smoothing interpolation in routine get_ops3
 genqsat.f90             - rename "prsl" as "ges_prsl"
 genstats_gps.f90        -  modify to take advantage of convinfo module
 glbsoi.f90              - modify for new data counting; absorb set_nrr_var
                           into compute_derived; move read*files calls into 
                           gesinfo; consolidate read*guess calls; replace 
                           pCRTM initialization with those for CRTM
 gridmod.f90             - add sigsum; correct error to dx_an,dy_an when 
                           using filled_grid; add optional (lat,lon) arguments
                           to routine get_ij
 gsimain.F90             - modify for new obs handling; move deallocate array
                           calls up from gsisub
 gsisub.f90              - consolidate guess file queury code into gesinfo;
                           move dellocate array calls up to gsimain
 guess_grids.f90         - prefix guess field arrays prsi, prsl, lnprsl, and 
                           prslk with string "ges_"; add status check on 
                           allocate and deallocate
 intall.f90              - improve mpi reproducibility
 intjc.f90               - rename prsi as ges_prsi
 intrad.f90              - clean up formatting of code
 intref.f90              - specify type for real variables w1,w2,...,w12
 jfunc.f90               - remove prsi_oz (now use ges_prsi)
 nlmsas_ad.f90           - fix bug in logical cnvflg (add array index)
 normal_rh_to_q.f90      - move sigsum calculation to compute_derived; clean
                           up code
 obs_para.f90            - modify for new obs handling and data counting
 obsmod.f90              - modify for new obs handling and data counting;
                           simplify makecobs call; add status check to 
                           allocate and deallocate; rename "obs_s" and "obs_o"
                           variables to more intuitive names, "obs_setup" and 
                           "obs_inner", respectively; replace array "id" with
                           "dplat"
 ozinfo.f90              - modify for new obs handling; remove function 
                           ifind_oz (not used)
 pcgsoi.f90              - add check on twodvar_regional logical flag to 
                           prevent code from entering bias correction update
                           block when running in 2DVAR mode
 pcpinfo.f90             - modify for new obs handling; remove variable myper
                           from create_pcp_random call (not used)
 prewgt.f90              - clean up sl array calculations; replace rdsfull with
                           read_gfssfc_full; place upper/lower bounds on 
                           qoption=2 variance; invert hzscl
 prewgt_reg.f90          - place upper/lower bounds on qoption=2 variance;
                           invert hzscl
 q_diag.f90              - replace mpi_real8 with mpi_rtype; clean up 
                           formatting of q diagnostic printout
 qcmod.f90               - correct bug in upprof and dwprof loop logic
 qcssmi.f90              - modify for new obs handling and printing of results
 rad_tran_k.f90          - rewrite to invoke CRTM instead of pCRTM
 radinfo.f90             - modify for new obs handling
 read_airs.f90           - remove call to getsfc (now called in read_obs);
                           modify for new obs handling and data counting
 read_amsre.f90          - remove call to getsfc (now called in read_obs).
                           In subroutine deter_sfc_amsre_low, change names of
                           sno,isli,sst to sno_full,isli_full,sno_full to
                           avoid conflict with local fields of same name in
                           module guess_grids.f90; modify for new obs 
                           handling and data counting; modify the threshold 
                           for surface type determination and change the 
                           origin of satellite azimuth angle of AMSR-E for 
                           diagnostic file
 read_avhrr.f90          - remove call to getsfc (now called in read_obs);
                           modify for new obs handling and data counting
 read_avhrr_navy.f90     - remove call to getsfc (now called in read_obs);
                           modify for new obs handling and data counting
 read_bufrtovs.f90       - remove call to getsfc (now called in read_obs);
                           in subroutine deter_sfc, change names of sno
                           isli,sst to sno_full,isli_full,sno_full to avoid
                           conflict with local fields of same name in module
                           guess_grids.f90; modify for new obs handling and 
                           data counting
 read_files.f90          - use sigio to read NCEP GFS spectral coefficient file
                           header
 read_goesimg.f90        - remove call to getsfc (now called in read_obs);
                           modify for new obs handling and data counting
 read_goesndr.f90        - remove call to getsfc (now called in read_obs);
                           modify for new obs handling, convinfo, and data
                           counting
 read_gps.f90            - modify for new obs handling, convinfo, and data
                           counting; modify errors for refractivity and 
                           increase QC checks
 read_guess.f90          - improve mpi reproducibility for ozmz calculation; 
                           consolidate all read_guess calls into this 
                           routine; load 3d pressure and geopotential 
                           height grids
 read_lidar.f90          - modify for new obs handling, convinfo, and data
                           counting
 read_modsbufr.f90       - modify for new obs handling, convinfo, and data
                           counting
 read_obs.f90            - add new version of call to getsfc and destroy_sfc;
                           modify for new obs handling, convinfo, and data 
                           counting; remove read_ieeetovs; gather guess 3d
                           pressure to full domain array (used in 
                           read_prepbufr)
 read_ozone.F90          - modify for new obs handling and data counting;
                           remove option to read IEEE sbuv files
 read_pcp.f90            - remove calls to getsfc and destroy_sfc (now called
                           in read_obs); modify for new obs handling and 
                           data counting
 read_prepbufr.f90       - modify for new obs handling, convinfo, and data
                           counting; use interpolated guess 3d pressure in
                           errormod; save reported height for wind observations
 read_radar.f90          - modify for new obs handling, convinfo, and data
                           counting
 read_ssmi.f90           - remove getsfc, refs to sno,sli,sst,isli (not used);
                           modify for new obs handling and data counting
 read_ssmis.f90          - remove call to getsfc (now called in read_obs);
                           modify for new obs handling and data counting
 read_superwinds.f90     - modify for new obs handling, convinfo, and data
                           counting; correct error in units when bounding 
                           longitude
 read_wrf_mass_guess.F90 - remove load_prsges, load_geop_hgt, prsl, prslk (not
                           used); convert moisture mixing ratio as read in
                           from model guess file to specific humidity 
                           (variable assumed in gsi)
 read_wrf_nmm_guess.F90  - remove load_prsges,load_geop_hgt,prsi,prsl (not 
                           used)
 satthin.F90             - remove all getsfc routines and create new getsfc
                           routine which makes full sfc fields from 
                           guess_grids; rename full surface fields to 
                           sst_full, sno_full, etc to eliminate conflict 
                           with some fields with same names in guess_grids; 
                           also add new sfc fields u10_full, v10_full for 
                           future additions to sat thinning; remove deallocate
                           of full surface fields from destroygrids, so it is 
                           only done by destroy_sfc.
 setupbend.f90           - rename lnprsl as ges_lnprsl, modify to take 
                           advantage of convinfo module; update QC parameters
                           and compute representativeness error; fix bug when 
                           counting obs that fail gross qc check; fix bug 
                           when rejecting obs that fail sats QC
 setupdw.f90             - store wgt/wgtlim in rdiagbuf(6,ii); rename lnprsl 
                           as ges_lnprsl; modify to take advantage of 
                           convinfo module
 setupjc.f90             - rename prsi as ges_prsi
 setupoz.f90             - modify for new obs handling, data counting and
                           printing of results; remove unused variables; 
                           correct logic error when processing data which is
                           not assimilated
 setuppcp.f90            - modify for new obs handling, data counting and
                           printing of results; introduce get_ij
 setupps.f90             - rename lnprsl as ges_lnprsl; modify to take 
                           advantage of convinfo module
 setuppw.f90             - store wgt/wgtlim in rdiagbuf(6,ii); rename prsi as
                           ges_prsi; modify to take advantage of convinfo 
                           module
 setupq.f90              - fix bug in printout; rename lnprsl as ges_lnprsl;
                           modify to take advantage of convinfo module
 setuprad.f90            - modify for new obs handling, data counting and 
                           printing of results; introduce get_ij, replace
                           pCRTM with CRTM; rename prsi as ges_prsi
 setupref.f90            - rename lnprsl as ges_lnprsl; modify to take 
                           advantage of convinfo module; update QC parameters
                           and compute preliminary representativeness error;
                           fix bug when countin obs that fail gross check
 setuprhsall.f90         - modify for new obs handling, data counting, 
                           printing of results and clean up routine; move
                           create/destroy array, compute_derived, q_diag from
                           glbsoi outer loop into this routine; modifications
                           for CRTM (pass channelinfo structure)
 setuprw.f90             - store wgt/wgtlim in rdiagbuf(6,ii); rename lnprsl as
                           ges_lnprsl; modify to take advantage of convinfo
                           module
 setupspd.f90            - store wgt/wgtlim in rdiagbuf(6,ii); rename lnprsl as
                           ges_lnprsl; modify to take advantage of convinfo
                           module; correct vertical dimension (nsig) in ges_tv
                           interpolation
 setupsrw.f90            - check logical last before loading obsmod array; 
                           store wgt/wgtlim in rdiagbuf(6,ii); rename lnprsl 
                           as ges_lnprsl; modify to take advantage of 
                           convinfo module
 setupsst.f90            - store wgt/wgtlim in rdiagbuf(6,ii); modify to take
                           advantage of convinfo module
 setupt.f90              - rename lnprsl as ges_lnprsl; modify to take 
                           advantage of convinfo module
 setupw.f90              - correct bugs in modis wind qc; rename lnprsl as
                           ges_lnprsl; correct vertical dimension (nsig) in 
                           ges_tv interpolation; use height when processing
                           VAD, profiler, and pibal winds; modify to take
                           advantage of convinfo module
 sst_retrieval.f90       - modify for new obs handling
 statsconv.f90           - modify for new obs handling, data counting and
                           printing of results
 statsoz.f90             - modify for new obs handling, data counting and
                           printing of results
 statspcp.f90            - modify for new obs handling, data counting and
                           printing of results
 statsrad.f90            - modify for new obs handling, data counting and
                           printing of results
 stpcalc.f90             - replace mype+1 with mm1=mype+1 in array index
 stpjc.f90               - rename prsi as ges_prsi
 support_2dvar.f90       - remove unused variables and routines from 
                           use guess_grids statement
 tpause.f90              - rename prsl and ges_prsl
 update_guess.f90        - replace prsi_oz with ges_prsi
 write_all.f90           - use ncepgfs_io moduel to handle NCEP GFS output
 wrwrfmassa.F90          - rename prslk as ges_prslk; convert analysis
                           specific humidity to model mixing ratio



MAKEFILE CHANGES
----------------
The following changes are made to Makefiles:

 a) Makefile
     - remove reference to IRSSE
     - add reference to sigio
     - remove files under FILES REMOVED section
     - add files under FILES ADDED section

 b) Makefile.conf.AIX
     - remove reference to IRSSE library and modules
     - add reference to CRTM modules and library
     - add reference to sigio module and library
     - change WRF libary and module references to point to new 
       (frozen) directories

 c) Makefile.conf.IRIX, Makefile.conf.IRIX64, Makefile.conf.Linux, 
    Makefile.conf.Linux.IA64.efc, Makefile.conf.Linux.IA64.ifort, 
    Makefile.conf.OSF1
     - remove reference to IRSSE library and modules
     - add reference to sigio module and library

     *** WARNING ***  
        Changes to non-AIX configuration files have NOT been tested.
        Further changes or corrections to changes made may be necessary.
     *** WARNING ***

 c) Makefile.dependency            
     - update dependencies to be consistent with above source code changes



SCRIPT CHANGES
--------------
The folowing changes are made to the indicated script files:
 
 a) analyzer 
     - add assignments for CRTM fix files (retain pCRTM assignments since
       CRTM and pCRTM expect different local file names for fixed file input)
     - update satlist and ozlist string to be consistent with new diagnostic
       file names

     *** WARNING ***
        Changes to "analyzer" and gsi.rc.sample have NOT been tested.
        Further changes or corrections to changes made may be necessary.
     *** WARNING ***

 b) gsi.rc.sample
     - invert values for hzscl in namelist BKGERR.  Previous resource file had
       "hzscl=1.1547,0.8163,0.5774,".  The sample resource file provided with
       this GSI release takes one over the above values to obtain
       "hzscl=0.8660,1.225,1.732,".  This change is required in order for the
       resource file to be consistent with the change in the defintion of 
       parameter hzscl
     - modify namelist OBS_INPUT to be consistent with changes in code (see
       comments under rungsi_global.sh below)
     - set jpch_oz=94 in namelist SETUP to reflect increase in number of 
       entries in gmao_global_ozinfo.txt file (see FIX FILE CHANGES section
       for further information)

 c) rungsi_global.sh
     - Given improved mpi reproducibility, use blocking=unlimited instead of
       requesting fixed number of nodes

     - Update variance scaling parameters "as" in namelist BKGERR from 
          "as=0.45,0.45,0.7,0.8,0.5,0.5,1.0,1.0,"
       to 
          "as=0.6,0.6,0.6,0.6,0.8,0.6,1.0,1.0," 
       based on recent NCEP T382L64 hybrid GFS/GSI tuning runs.  Likewise,
       change dynamical constraint term "bamp_tin" in namelist JCOPTS from
       "bamp_tin=1.0e4" to "bamp_tin=1.0e5"

     - Invert values in namelist BKGERR horizontal scale factor parameter
       "hzscl" to be consistent with changes in code

     - Add new or redefine existing variables in OBS_INPUT namelist as follows:
        dfile - name of local file containing data (no change)  
        dtype - type (category or instrument) of observation (no change)
        dplat - observing platform.  Was integer array "id", now a 
                character(10) array.
        dsis  - combined type/platform tag. For CRTM the string used here must
                match a satellite/sensor combination recognized/found in the
                CRTM fix files.  For satellite brightness temperature data,
                this string is also used in the air mass and angle dependent
                bias correction files
        dval  - relative weighting among members within group
        dthin - parameter to group satellite Tb data into thinning groups

     - To clear up confusion between bufr and non-bufr input observation files,
       copy observation files to local filenames containing the string "bufr"
       or "bfr".   The observation local file names are correspondingly changed
       in OBS_INPUT variable dfile.  Please note that this change is NOT
       necessary.  Users may give local copies of observation input files
       whatever name they desire.  The only requirement be that whatever
       name is used, this must be the name placed in the dfile variable in
       namelist OBS_INPUT.  Currently the size of the local file name is
       limited to 10 characters (see obsmod.f90)

     - Replace copy of pCRTM fixed files with CRTM counterparts

     - Update diagnostic file name strings to be consistent with new naming
       convention

 d) rungsi_regional_mass_binary.sh
     - similar changes to those made in rungsi_global.sh script with the
       following exceptions/additions
       1) Replace variance scaling parameters "as" in namelist BKGERR with
          "as=0.15,0.15,0.15,0.3,0.5,0.5,1.0,1.0," based on NCEP NMM/GSI
           tuning experiments.
       2) Change path to MASS binary sample case.  No change in case, just 
          path.
       3) Add lines to automatically generate GrADS-viewable binary versions
          of guess and analysis files.  
       4) Save updated air mass bias correction file to list of files copied
          to $savdir following completion of analysis

 e) rungsi_regional_nmm_netcdf.sh
     - same changes as those made to rungsi_regional_mass_netcdf.sh except
       item 3)

 f) rungsi_regional_nmm_binary.sh
     - same changes as those made to rungsi_regional_mass_netcdf.sh except
       item 3) which was already present in rungsi_regional_nmm_binary.sh
       script

 g) rungsi_regional_mass_binary.sh
     - same chagnes as as those made to rungsi_regional_mass_netcdf.sh except
       item 3)

 f) rungsi_regional_twodvar_binary.sh
     - Given improved mpi reproducibility, use blocking=unlimited instead of
       requesting fixed number of nodes

     - Remove jpch=0,npred=0,npredp=0 from namelist SETUP.  These parameters
       CAN NOT be set to zero.  Doing so causes the code to fail when run
       with array bounds checking on.  Variables jpch,npred, and npredp serve
       as array dimensions in radinfo.f90 and pcpinfo.f90 (and elsewhere).

     - Invert values in namelist BKGERR horizontal scale factor parameter
       "hzscl" to be consistent with changes in code

     - Update variables in OBS_INPUT namelist to be consistent with code 
       changes

     - Even though radiance assimilation is not currently an option when
       running in 2DVAR mode, replace defintion of pCRTM fix files with
       appropriate CRTM counterparts.

     - Update diagnostic file name strings to be consistent with new naming
       convention

 

FIX FILE CHANGES
----------------
The following changes are made to fix files:

 a) global_convinfo.txt, gmao_global_convinfo.txt
     - add column to specify observation subtype
     - ***NOTE*** 
          This change renders convinfo files from previous GSI releases
          incompatible with this GSI release.  Users must update convinfo
          files to the new format.

 b) global_ozinfo.txt, gmao_global_ozinfo.txt
     - replace numeric satellite/sensor id with character string
     - add NOAA-7, NOAA-9, and NOAA-11 SBUV (assimilation turned on)
       This addition is only made in gmao_global_ozinfo.txt.
     - ***NOTE***
          The first change renders ozinfo files from previous GSI releases
          incompatible with this GSI release.  Users must update ozinfo
          files to the new format.

 c) global_pcpinfo.txt, gmao_global_pcpinfo.txt
     - replace numeric satellite/sensor id with character string
     - remove unused satellite/sensor types
     - ***NOTE***
          The first change renders pcpinfo files from previous GSI releases
          incompatible with this GSI release.  Users must update pcpinfo
          files to the new format.

 d) global_satinfo.txt, gmao_global_satinfo.txt
     - replace numeric satellite/sensor id with character string
     - remove polarization information (no longer needed)
     - turn off assimilation of NOAA-15 AMSU-B channel 4.  Assimilation
       of this channel was turned off in NCEP operations on 2006021612 
       due to increased noise in the channel.  GSI global_satinfo.txt 
       file was changed to be consistent with NCEP operations.  This
       change is not needed when running cases prior to 2006021612
     - ***NOTE***
          The first and second changes render satinfo files from previous
          GSI releases incompatible with this GSI release.  Users must 
          update satinfo files to the new format.

 e) gmao_global_satinfo.txt
     - replace numeric satellite/sensor id with character string
     - remove polarization information (no longer needed)
     - ***NOTE***
          These changes render satinfo files from previous
          GSI releases incompatible with this GSI release.  Users must
          update satinfo files to the new format.

 e) regional_convinfo.txt
     - add column to specify observation subtype
     - ***NOTE***
          This change renders convinfo files from previous GSI releases
          incompatible with this GSI release.  Users must update convinfo
          files to the new format.

 f) regional_satinfo.txt 
     - replace numeric satellite/sensor id with character string
     - remove polarization information (not needed)
     - turn on assimilation of AMSU-A channels 1-5 and 15 for NOAA-15, -16, 
       -18, and AQUA AMSUA
     - turn off assimilation of NOAA-15 AMSUB channel 4 (see comments for
       global_satinfo.txt above)
     - ***NOTE***
          The first and second changes render satinfo files from previous
          GSI releases incompatible with this GSI release.  Users must
          update satinfo files to the new format.

 g) global_berror.l64y386.hyb.f77, global_berror.l64y258.sig.f77,
    global_berror.l64y96.hyb.f77, global_berror.l64y96.sig.f77
     - updated to include full nlevs projection for surface pressure

 h) regional_nmm_berror.f77
     - new statistics computed from full North America NMM domain

 i) global_satangbias.txt 
     - recomputed using 25 days (100 samples) worth of cycled radiance 
       diagnostic files using the CRTM.  Only innovations passing 
       quality control were used to compute the new angle dependent 
       bias.
     - replace numeric satellite/sensor id with character string
     - ***NOTE 1***
          The second change renders satinfo files from previous GSI releases
          incompatible with this GSI release.  Users must update angle 
          dependent bias correction files to the new format.
     - ***NOTE 2***
          Though not a fixed file, users should be aware that the format
          of the the input air mass bias correction file (refered to as 
          file "satbias_in" from radinfo.f90) has changed with this GSI
          release.  The numeric satellite/sensor id has been replaced
          with a character string.  Failure to update the air mass bias
          bias correction files to this new format will cause a code failure.



GLOBAL NCEP T382L64 TEST
------------------------
Script  :  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603/rungsi_global.sh
Old code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200512
New code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603

Maximum resident set size
old :  1357392 Kbytes
new :  1340016 Kbytes


Wall clock (48 tasks, blocking=unlimited)
old : 3652.568905 seconds (see note (a) below)
new : 3101.250584 seconds

Output from the first iteration of the minimization
old : penalty,grad ,a,b= 1 0 0.695319310181544162E+06 0.970529767896815017E+07 0.434391804723576087E-02 0.000000000000000000E+00
new : penalty,grad ,a,b= 1 0 0.689507543645551661E+06 0.134955773994416650E+08 0.180246589159577231E-02 0.000000000000000000E+00

Output from the final iteration of the minimization
old : penalty,grad ,a,b= 2 100 0.420497605588523438E+06 0.175147305076344423E+04 0.996053243003757523E-03 0.110085975574692396E+01
new : penalty,grad ,a,b= 2 100 0.395913920397863956E+06 0.251002104410874999E+05 0.243682851861251002E-03 0.125030699201627971E+01

NOTES:
   a) When running with blocking=unlimited, there is greater run to run 
      variability in wall clock times due.  Thus, not much emphasis 
      should be placed on wall clock differences between the previous
      (old) and new versions of the code



REGIONAL NCEP NMM BINARY TEST
-----------------------------
Script  :  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603/rungsi_regional_nmm_binary.sh
Old code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200512
New code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603

Maximum resident set size
old :  519640 Kbytes
new :  515032 Kbytes

Wall clock (48 tasks, blocking=unlimited)
old :  1279.782629 seconds
new :   929.512327 seconds

Output from the first iteration of the minimization
old : penalty,grad ,a,b= 1 0 0.150476659809649049E+06 0.295208206294617578E+08 0.148966380658503250E-03 0.000000000000000000E+00
new : penalty,grad ,a,b= 1 0 0.155290547868445690E+06 0.256402531490964582E+07 0.389710433692603804E-02 0.000000000000000000E+00

Output from the final iteration of the minimization
old : penalty,grad ,a,b= 2 100 0.117465814207114367E+06 0.178814369340881179E+02 0.164876997752569344E-02 0.405641696585215927E+00
new : penalty,grad ,a,b= 2 100 0.106603351153455995E+06 0.216509008076522617E-01 0.636934040702895245E-02 0.457931704707866594E+00

NOTES:
   a) Recall that the new run uses different values for the variance
      scaling parameters ("as") as well as a new background error
      file.  Hence larger differences in the final gradient.



REGIONAL NCEP NMM NETCDF TEST
-----------------------------
Script  :  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603/rungsi_regional_nmm_netcdf.sh
Old code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200512
New code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603

Maximum resident set size
old :  219432 Kbytes
new :  226580 Kbytes

Wall clock (24 tasks, blocking=unlimited)
old :  307.200904 seconds
new :  320.453151 seconds

Output from the first iteration of the minimization
old : penalty,grad ,a,b= 1 0 0.273088264806887237E+05 0.636432089328166447E+06 0.239407582087830181E-02 0.000000000000000000E+00
new : penalty,grad ,a,b= 1 0 0.294520211509247893E+05 0.647883018750244752E+06 0.200110844250519452E-02 0.000000000000000000E+00

Output from the final iteration of the minimization
old   penalty,grad ,a,b= 2 70 0.201910813909321296E+05 0.578156569433122100E-04 0.425290758934856530E-01 0.685846257726994812E+00
new   penalty,grad ,a,b= 2 51 0.218361978340558271E+05 0.570784282351150302E-04 0.513727917196265191E-01 0.583744520302494463E+00

NOTES:
   a) Recall that the new run uses different values for the variance
      scaling parameters ("as") as well as a new background error
      file.  Hence a different termination point for the minimization.



REGIONAL NCEP MASS BINARY TEST
------------------------------
Script  :  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603/rungsi_regional_mass_binary.sh
Old code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200512
New code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603

Maximum resident set size
old :  237036 Kbytes
new :  247688 Kbytes

Wall clock (24 tasks, blocking=unlimited)
old :  473.432016 seconds
new :  478.347822 seconds

Output from the first iteration of the minimization
old : penalty,grad ,a,b= 1 0 0.298488521499862218E+05 0.157244719872385580E+08 0.275442841541106043E-03 0.000000000000000000E+00
new : penalty,grad ,a,b= 1 0 0.423265391131813667E+05 0.193911520300954655E+08 0.275661699345735635E-03 0.000000000000000000E+00

Output from the final iteration of the minimization
old : penalty,grad ,a,b= 2 100 0.151835162191882209E+05 0.302897110329113104E+03 0.600128980922145388E-03 0.961543264141132115E+00
new : penalty,grad ,a,b= 2 100 0.164021212172216692E+05 0.130682215768031756E+04 0.342884854713144287E-03 0.715898299725537202E+00

NOTES:
   a) The large increase in the initial penalty is due to the
      use of reported height for vertical interpolation in
      the forward model for VAD and profiler winds.  An 
      explanation for this result is lacking.  For the 
      NMM binary, NMM netcdf, and GFS cases the wind penalty
      is nearly equal or reduced.  The test cases for these
      configurations indicate that using height in the forward
      model for VAD, profiler, and PIBAL winds improves the
      guess fit to the observations.  The large penalty for 
      the MASS core cases may point to issues regarding how
      geopoential is computed for this dynamical core within
      the GSI.  Alternatively, there may be problems with the
      reported height in the prepbufr file provided for this
      case.  A closer look at these results is warranted.
      Users / developers who run the GSI in regional mode
      using the MASS core are advised to test both height
      and pressure based interpolation for VAD, profiler,
      and PIBAL winds for their specific cases.  The routine
      to examine is setupw.f90.
      


REGIONAL NCEP MASS NETCDF TEST
------------------------------
Script  :  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603/rungsi_regional_mass_netcdf.sh
Old code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200512
New code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603

Maximum resident set size
old :  240792 Kbytes
new :  265672 Kbytes

Wall clock (24 tasks, blocking=unlimited)
old :  293.31697 seconds
new :  285.367428 seconds

Output from the first iteration of the minimization
old : penalty,grad ,a,b= 1 0 0.362935273818532587E+05 0.241405577564830630E+06 0.116240538018160550E-01 0.000000000000000000E+00
new : penalty,grad ,a,b= 1 0 0.703904579986519093E+05 0.603675974701557774E+06 0.244848852282668825E-01 0.000000000000000000E+00

Output from the final iteration of the minimization
old : penalty,grad ,a,b= 2 70 0.262668035235406533E+05 0.202326406733268451E-04 0.336996756777608389E-01 0.414362786497749769E+00
new : penalty,grad ,a,b= 2 62 0.288257708297292120E+05 0.574432008928087956E-04 0.247066504326180977E-01 0.736532978828509655E+00

NOTES:
   a) The large increase in the initial penalty is due to the
      use of reported height for vertical interpolation in 
      the forward model for VAD and profiler winds.



REGIONAL NCEP TWODVAR BINARY TEST
---------------------------------
Script  :  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603/rungsi_regional_twodvar_binary.sh
Old code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200512
New code:  /nfsuser/g01.1/weather/wx20rt/gsi_anl/sorc/gsi_cvs.200603

Maximum resident set size
old :  264180 Kbytes
new :  299576 Kbytes

Wall clock (24 tasks, blocking=unlimited)
old :  277.121413 seconds
new :  269.34952 seconds

Output from the first iteration of the minimization
old : penalty,grad ,a,b= 1 0 0.567637776617817435E+05 0.328538326412036840E+06 0.198365850765129248E-01 0.000000000000000000E+00
new : penalty,grad ,a,b= 1 0 0.567637776617817435E+05 0.328538326412036840E+06 0.198365850765129248E-01 0.000000000000000000E+00

Output from the final iteration of the minimization
old : penalty,grad ,a,b= 2 80 0.444910158648351862E+05 0.312040793961442789E-03 0.127586661643548423E-01 0.765838716234202854E+00
new : penalty,grad ,a,b= 2 80 0.444910158648351862E+05 0.312040793961442789E-03 0.127586661643548423E-01 0.765838716234202854E+00

NOTES:
   a) As noted in the EXPECTED DIFFERENCES section, correction
      of loop limit and code flow errors does not affect
      results for the given 2DVAR test case.  

